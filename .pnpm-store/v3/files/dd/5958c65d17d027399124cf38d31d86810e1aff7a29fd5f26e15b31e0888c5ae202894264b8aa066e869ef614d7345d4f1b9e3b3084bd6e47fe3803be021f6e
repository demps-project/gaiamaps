function e(){return e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},e.apply(this,arguments)}const t=new Map([["t","true"],["f","false"],["n","null"]]),n=new Map([['"','"'],["\\","\\"],["/","/"],["b","\b"],["n","\n"],["f","\f"],["r","\r"],["t","\t"]]),s=new Map([["[","Punctuator"],["]","Punctuator"],["{","Punctuator"],["}","Punctuator"],[":","Punctuator"],[",","Punctuator"],["true","Boolean"],["false","Boolean"],["null","Null"]]);class o extends Error{constructor(e,{line:t,column:n,index:s}){super(`${e} (${t}:${n})`),this.line=t,this.column=n,this.index=s}}class r extends o{constructor(e,t){super(`Unexpected character ${e} found.`,t)}}class u extends o{constructor(e){super(`Unexpected token ${e.type}(${e.value}) found.`,e.loc.start)}}class i extends o{constructor(e){super("Unexpected end of input found.",e)}}const l={comments:!1,ranges:!1};function c(e){return/[\s\n]/.test(e)}function a(e){return e>="0"&&e<="9"}function f(e){return a(e)||/[a-f]/i.test(e)}function m(e){return/[tfn]/.test(e)}function h(e){return a(e)||"."===e||"-"===e}const p={tokens:!1,comments:!1,ranges:!1};function d(e){switch(e.type){case"Boolean":return"true"===e.value;case"Number":return Number(e.value);case"Null":return null;case"String":return function(e){let t=e.value.slice(1,-1),s="",r=t.indexOf("\\"),u=0;for(;r>=0;){s+=t.slice(u,r);const i=t.charAt(r+1);if(n.has(i))s+=n.get(i),u=r+2;else{if("u"!==i)throw new o(`Invalid escape \\${i}.`,{line:e.loc.start.line,column:e.loc.start.column+r,offset:e.loc.start.offset+r});{const n=t.slice(r+2,r+6);if(n.length<4||/[^0-9a-f]/i.test(n))throw new o(`Invalid unicode escape \\u${n}.`,{line:e.loc.start.line,column:e.loc.start.column+r,offset:e.loc.start.offset+r});s+=String.fromCharCode(parseInt(n,16)),u=r+6}}r=t.indexOf("\\",u)}return s+=t.slice(u),s}(e)}}var g=function e(t){switch(t.type){case"String":case"Number":case"Boolean":return t.value;case"Null":return null;case"Array":return t.elements.map(e);case"Object":{const n={};return t.members.forEach(t=>{n[e(t.name)]=e(t.value)}),n}case"Document":return e(t.body);case"Property":throw new Error("Cannot evaluate object property outside of an object.");default:throw new Error(`Unknown node type ${t.type}.`)}};function y(e,t){return{message:e,severity:"error",from:t.loc.start.offset,to:t.loc.end.offset}}class v extends Error{constructor(e){super(),this.issues=[];const t=new.target.prototype;Object.setPrototypeOf(this,t),this.issues=e}get message(){return JSON.stringify(this.issues,null,2)}}const b=new Set(["Feature"]),w=new Set(["Point","MultiPoint","Polygon","MultiPolygon","LineString","MultiLineString","GeometryCollection"]),P=new Set(["Point","MultiPoint","Polygon","MultiPolygon","LineString","MultiLineString"]),S=new Set(Array.from(w).concat(["Feature","FeatureCollection"]));function x(e,t,n){if("Object"!==t.type)throw new v([y("Expected an object, but found an incorrect type.",t)]);const s=t.members.find(e=>"type"===e.name.value);if(!s)return e.issues.push(y("This GeoJSON object is missing its type member.",t)),{};const o=s.value;return"String"!==o.type?(e.issues.push(y("The type member should have been a string.",t)),{}):n.has(o.value)?{type:o.value,objectNode:t}:(e.issues.push(y("This type of GeoJSON object is not allowed here.",t)),{})}function j(e,t,n){const s=t.members.find(e=>e.name.value===n);return s?s.value:(e.issues.push(y(`This GeoJSON object requires a ${n} member but it is missing.`,t)),null)}function N(e,t){return"Array"===(null==t?void 0:t.type)?t:(t&&e.issues.push(y("This must be an array.",t)),null)}function O(e,t){return"Object"===(null==t?void 0:t.type)?t:(t&&e.issues.push(y("This must be an object.",t)),null)}function M(e,t,n){for(const s of t)if("Number"!==s.type)return void e.issues.push(y(`Each element in a ${n} must be a number.`,s))}function $(e,t){null!==t&&((t.elements.length<2||t.elements.length>3)&&e.issues.push(y(`A position should have 2 or 3 elements - found ${t.elements.length}.`,t)),M(e,t.elements,"position"))}function F(e,t){return"Array"!==t.type?(e.issues.push(y("Expected to find an array of positions here.",t)),null):t}function A(e,t,n){if(null!==t&&(t=F(e,t))){for(const n of t.elements){if("Array"!==n.type)return void e.issues.push(y("Expected to find a position here, found another type.",n));$(e,n)}switch(n){case"LineString":t.elements.length<2&&e.issues.push(y("Expected to find two or more positions here.",t));break;case"Polygon":t.elements.length<4&&e.issues.push(y("Expected to find four or more positions here.",t)),function(e,t){const n=t.elements[0],s=t.elements[t.elements.length-1],o=Math.max(n.elements.length,s.elements.length);for(let t=0;t<o;t++){var r,u;if((null==(r=n.elements[t])?void 0:r.value)!==(null==(u=s.elements[t])?void 0:u.value))return void e.issues.push(y("First and last positions of a Polygon or MultiPolygon’s ring should be the same.",n),y("First and last positions of a Polygon or MultiPolygon’s ring should be the same.",s))}}(e,t)}}}function C(e,t,n){if(null!==t&&(t=F(e,t)))for(const s of t.elements)A(e,s,n)}function E(e,t){const n=t.members.find(e=>"bbox"===e.name.value);if(void 0===n)return;const s=N(e,n.value);s&&(4!==s.elements.length&&6!==s.elements.length&&e.issues.push(y("A bbox must have 4 or 6 positions",s)),M(e,s.elements,"bbox"))}function k(e,t,n,s){t.name.value===s&&e.issues.push(y(`${n} objects cannot contain a member named ${t.name.value}`,t.name))}const L={Geometry:["properties","geometry","features"],Feature:["features"],FeatureCollection:["properties","coordinates"]};function T(e,t,n){for(const s of t.members)for(const t of L[n])k(e,s,n,t)}function G(e,t){const n=j(e,t,"coordinates");return n?N(e,n):null}const B=(e,t)=>{E(e,t),T(e,t,"Geometry")},J=(e,t)=>{T(e,t,"Feature");const n=j(e,t,"geometry");if(E(e,t),"Null"!==(null==n?void 0:n.type)){const t=O(e,n);t&&U(e,t,w)}const s=t.members.find(e=>"id"===e.name.value);s&&"String"!==s.value.type&&"Number"!==s.value.type&&e.issues.push(y("The Feature id must be a string or number.",t));const o=j(e,t,"properties");if(!o)return void e.issues.push(y("The properties member is missing.",t));const{type:r}=o;"Object"!==r&&"Null"!==r&&e.issues.push(y("The Feature properties member can be an object or null.",t))},I={LineString:(e,t)=>{A(e,G(e,t),"LineString"),B(e,t)},MultiLineString:(e,t)=>{C(e,G(e,t),"LineString"),B(e,t)},Polygon:(e,t)=>{C(e,G(e,t),"Polygon"),B(e,t)},MultiPolygon:(e,t)=>{!function(e,t,n){if(null!==t&&(t=F(e,t)))for(const n of t.elements)C(e,n,"Polygon")}(e,G(e,t)),B(e,t)},Point:(e,t)=>{$(e,G(e,t)),B(e,t)},MultiPoint:(e,t)=>{A(e,G(e,t)),B(e,t)},GeometryCollection:(e,t)=>{B(e,t);const n=N(e,j(e,t,"geometries"));if(n)for(const t of n.elements)U(e,t,P)},Feature:J,FeatureCollection:(e,t)=>{T(e,t,"FeatureCollection");const n=N(e,j(e,t,"features"));if(n)for(const t of n.elements){const n=e.issues.length,s=O(e,t);s&&(x(e,s,b),J(e,s)),e.valid.push(e.issues.length===n?void 0:e.issues.slice(n))}}};function U(e,t,n=S){const{type:s,objectNode:o}=x(e,t,n);s&&o&&(function(e,t){const n=new Set;for(const s of t.members){const{name:{value:t}}=s;n.has(t)&&e.issues.push(y("Duplicate properties are ambiguous in GeoJSON",s)),n.add(t)}}(e,o),I[s](e,o))}function D(e){const o={issues:[],valid:[]};let g;try{g=function(e,o){const g=function(e,o){o=Object.freeze({...l,...o});let u=-1,p=1,d=0,g=!1;const y=[];function v(e,t,n,s){const r=n.offset+t.length;return{type:e,value:t,loc:{start:n,end:s||{line:n.line,column:n.column+t.length,offset:r}},...o.ranges?{range:[n.offset,r]}:void 0}}function b(){let t=e.charAt(++u);return g?(p++,d=1,g=!1):d++,"\r"===t?(g=!0,"\n"===e.charAt(u+1)&&u++):"\n"===t&&(g=!0),t}function w(){return{line:p,column:d,offset:u}}function P(n){let s=t.get(n);if(e.slice(u,u+s.length)===s)return u+=s.length-1,d+=s.length-1,{value:s,c:b()};for(let t=1;t<s.length;t++)s[t]!==e.charAt(u+t)&&N(b())}function S(e){let t=e;for(e=b();e&&'"'!==e;){if("\\"===e)if(t+=e,e=b(),n.has(e))t+=e;else if("u"===e){t+=e;for(let n=0;n<4;n++)f(e=b())?t+=e:N(e)}else N(e);else t+=e;e=b()}return e||O(),t+=e,{value:t,c:b()}}function x(e){let t="";if("-"===e&&(t+=e,a(e=b())||N(e)),"0"===e)t+=e,a(e=b())&&N(e);else{(function(e){return e>="1"&&e<="9"})(e)||N(e);do{t+=e,e=b()}while(a(e))}if("."===e)do{t+=e,e=b()}while(a(e));if("e"===e||"E"===e)for(t+=e,"+"!==(e=b())&&"-"!==e||(t+=e,e=b()),a(e)||N(e);a(e);)t+=e,e=b();return{value:t,c:e}}function j(e){let t=e;if("/"===(e=b())){do{t+=e,e=b()}while(e&&"\r"!==e&&"\n"!==e);return{value:t,c:e}}if("*"===e){for(;e;)if(t+=e,"*"===(e=b())&&(t+=e,"/"===(e=b())))return t+=e,{value:t,c:e=b()};O()}N(e)}function N(e){throw new r(e,w())}function O(){throw new i(w())}let M=b();for(;u<e.length;){for(;c(M);)M=b();if(!M)break;const e=w();if(s.has(M))y.push(v(s.get(M),M,e)),M=b();else if(m(M)){const t=P(M);let n=t.value;M=t.c,y.push(v(s.get(n),n,e))}else if(h(M)){const t=x(M);M=t.c,y.push(v("Number",t.value,e))}else if('"'===M){const t=S(M);M=t.c,y.push(v("String",t.value,e))}else if("/"===M&&o.comments){const t=j(M);let n=t.value;M=t.c,y.push(v(n.startsWith("//")?"LineComment":"BlockComment",n,e,w()))}else N(M)}return y}(e,{comments:!!(o=Object.freeze({...p,...o})).comments,ranges:!!o.ranges});let y=0;const v=o.comments?function e(){const t=g[y++];return t&&t.type.endsWith("Comment")?e():t}:function(){return g[y++]};function b(e,t){if(!e||e.value!==t)throw new u(e)}function w(e,t){return o.ranges?{range:[e.offset,t.offset]}:void 0}function P(e){const t=w(e.loc.start,e.loc.end);return{type:e.type,value:d(e),loc:{start:{...e.loc.start},end:{...e.loc.end}},...t}}function S(e){!function(e,t){if(!e||"String"!==e.type)throw new u(e)}(e);const t=P(e);b(e=v(),":");const n=x(),s=w(t.loc.start,n.loc.end);return((e,t,n={})=>({type:"Member",name:e,value:t,...n}))(t,n,{loc:{start:{...t.loc.start},end:{...n.loc.end}},...s})}function x(e){switch((e=e||v()).type){case"String":case"Boolean":case"Number":case"Null":return P(e);case"Punctuator":if("{"===e.value)return function(e){b(e,"{");const t=[];let n=v();if(n&&"}"!==n.value)do{if(t.push(S(n)),n=v(),","!==n.value)break;n=v()}while(n);b(n,"}");const s=w(e.loc.start,n.loc.end);return((e,t={})=>({type:"Object",members:e,...t}))(t,{loc:{start:{...e.loc.start},end:{...n.loc.end}},...s})}(e);if("["===e.value)return function(e){b(e,"[");const t=[];let n=v();if(n&&"]"!==n.value)do{if(t.push(x(n)),n=v(),","!==n.value)break;n=v()}while(n);b(n,"]");const s=w(e.loc.start,n.loc.end);return((e,t={})=>({type:"Array",elements:e,...t}))(t,{type:"Array",elements:t,loc:{start:{...e.loc.start},end:{...n.loc.end}},...s})}(e);default:throw new u(e)}}const j=x(),N=v();if(N)throw new u(N);const O={loc:{start:{line:1,column:1,offset:0},end:{...j.loc.end}}};return o.tokens&&(O.tokens=g),o.ranges&&(O.range=w(O.loc.start,O.loc.end)),((e,t={})=>({type:"Document",body:e,...t}))(j,O)}(e,{ranges:!0}),U(o,g.body)}catch(e){o.issues.push({message:`Invalid JSON: ${e.message}`,from:0,to:0,severity:"error"})}return{ast:g,ctx:o}}const z=e=>D(e).ctx.issues,W=e=>{const{ctx:t,ast:n}=D(e);if(t.issues.length||!n)throw new v(t.issues);return g(n)},q=t=>{const{ctx:{issues:n,valid:s},ast:o}=D(t);if(!o)throw new v(n);const r=g(o);if(!n.length)return{result:r,rejected:[]};if("FeatureCollection"===r.type)return{result:e({},r,{features:r.features.filter((e,t)=>void 0===s[t])}),rejected:r.features.flatMap((e,t)=>{const n=s[t];return n?[{feature:e,reasons:n}]:[]})};throw new v(n)};export{v as HintError,W as check,z as getIssues,q as scavenge};
//# sourceMappingURL=index.modern.mjs.map
