function e(){return e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.apply(this,arguments)}function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(e)}function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function o(e,t,u){return o=r()?Reflect.construct:function(e,t,r){var o=[null];o.push.apply(o,t);var u=new(Function.bind.apply(e,o));return r&&n(u,r.prototype),u},o.apply(null,arguments)}function u(e){var r="function"==typeof Map?new Map:void 0;return u=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,u)}function u(){return o(e,arguments,t(this).constructor)}return u.prototype=Object.create(e.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),n(u,e)},u(e)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}const l=new Map([["t","true"],["f","false"],["n","null"]]),a=new Map([['"','"'],["\\","\\"],["/","/"],["b","\b"],["n","\n"],["f","\f"],["r","\r"],["t","\t"]]),c=new Map([["[","Punctuator"],["]","Punctuator"],["{","Punctuator"],["}","Punctuator"],[":","Punctuator"],[",","Punctuator"],["true","Boolean"],["false","Boolean"],["null","Null"]]);class f extends Error{constructor(e,{line:t,column:n,index:r}){super(`${e} (${t}:${n})`),this.line=t,this.column=n,this.index=r}}class p extends f{constructor(e,t){super(`Unexpected character ${e} found.`,t)}}class m extends f{constructor(e){super(`Unexpected token ${e.type}(${e.value}) found.`,e.loc.start)}}class h extends f{constructor(e){super("Unexpected end of input found.",e)}}const v={comments:!1,ranges:!1};function d(e){return/[\s\n]/.test(e)}function y(e){return e>="0"&&e<="9"}function b(e){return y(e)||/[a-f]/i.test(e)}function g(e){return/[tfn]/.test(e)}function w(e){return y(e)||"."===e||"-"===e}const O={tokens:!1,comments:!1,ranges:!1};function P(e){switch(e.type){case"Boolean":return"true"===e.value;case"Number":return Number(e.value);case"Null":return null;case"String":return function(e){let t=e.value.slice(1,-1),n="",r=t.indexOf("\\"),o=0;for(;r>=0;){n+=t.slice(o,r);const u=t.charAt(r+1);if(a.has(u))n+=a.get(u),o=r+2;else{if("u"!==u)throw new f(`Invalid escape \\${u}.`,{line:e.loc.start.line,column:e.loc.start.column+r,offset:e.loc.start.offset+r});{const u=t.slice(r+2,r+6);if(u.length<4||/[^0-9a-f]/i.test(u))throw new f(`Invalid unicode escape \\u${u}.`,{line:e.loc.start.line,column:e.loc.start.column+r,offset:e.loc.start.offset+r});n+=String.fromCharCode(parseInt(u,16)),o=r+6}}r=t.indexOf("\\",o)}return n+=t.slice(o),n}(e)}}var S=function e(t){switch(t.type){case"String":case"Number":case"Boolean":return t.value;case"Null":return null;case"Array":return t.elements.map(e);case"Object":{const n={};return t.members.forEach(t=>{n[e(t.name)]=e(t.value)}),n}case"Document":return e(t.body);case"Property":throw new Error("Cannot evaluate object property outside of an object.");default:throw new Error(`Unknown node type ${t.type}.`)}};function j(e,t){return{message:e,severity:"error",from:t.loc.start.offset,to:t.loc.end.offset}}var x=/*#__PURE__*/function(e){var t,r,o,u;function s(t){var n;(n=e.call(this)||this).issues=[];var r=(this instanceof s?this.constructor:void 0).prototype;return Object.setPrototypeOf(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),r),n.issues=t,n}return r=e,(t=s).prototype=Object.create(r.prototype),t.prototype.constructor=t,n(t,r),o=s,(u=[{key:"message",get:function(){return JSON.stringify(this.issues,null,2)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(o.prototype,u),Object.defineProperty(o,"prototype",{writable:!1}),s}(/*#__PURE__*/u(Error)),N=new Set(["Feature"]),M=new Set(["Point","MultiPoint","Polygon","MultiPolygon","LineString","MultiLineString","GeometryCollection"]),A=new Set(["Point","MultiPoint","Polygon","MultiPolygon","LineString","MultiLineString"]),E=new Set(Array.from(M).concat(["Feature","FeatureCollection"]));function F(e,t,n){if("Object"!==t.type)throw new x([j("Expected an object, but found an incorrect type.",t)]);var r=t.members.find(function(e){return"type"===e.name.value});if(!r)return e.issues.push(j("This GeoJSON object is missing its type member.",t)),{};var o=r.value;return"String"!==o.type?(e.issues.push(j("The type member should have been a string.",t)),{}):n.has(o.value)?{type:o.value,objectNode:t}:(e.issues.push(j("This type of GeoJSON object is not allowed here.",t)),{})}function C(e,t,n){var r=t.members.find(function(e){return e.name.value===n});return r?r.value:(e.issues.push(j("This GeoJSON object requires a "+n+" member but it is missing.",t)),null)}function k(e,t){return"Array"===(null==t?void 0:t.type)?t:(t&&e.issues.push(j("This must be an array.",t)),null)}function T(e,t){return"Object"===(null==t?void 0:t.type)?t:(t&&e.issues.push(j("This must be an object.",t)),null)}function L(e,t,n){for(var r,o=i(t);!(r=o()).done;){var u=r.value;if("Number"!==u.type)return void e.issues.push(j("Each element in a "+n+" must be a number.",u))}}function $(e,t){null!==t&&((t.elements.length<2||t.elements.length>3)&&e.issues.push(j("A position should have 2 or 3 elements - found "+t.elements.length+".",t)),L(e,t.elements,"position"))}function B(e,t){return"Array"!==t.type?(e.issues.push(j("Expected to find an array of positions here.",t)),null):t}function G(e,t,n){if(null!==t&&(t=B(e,t))){for(var r,o=i(t.elements);!(r=o()).done;){var u=r.value;if("Array"!==u.type)return void e.issues.push(j("Expected to find a position here, found another type.",u));$(e,u)}switch(n){case"LineString":t.elements.length<2&&e.issues.push(j("Expected to find two or more positions here.",t));break;case"Polygon":t.elements.length<4&&e.issues.push(j("Expected to find four or more positions here.",t)),function(e,t){for(var n=t.elements[0],r=t.elements[t.elements.length-1],o=Math.max(n.elements.length,r.elements.length),u=0;u<o;u++){var s,i;if((null==(s=n.elements[u])?void 0:s.value)!==(null==(i=r.elements[u])?void 0:i.value))return void e.issues.push(j("First and last positions of a Polygon or MultiPolygon’s ring should be the same.",n),j("First and last positions of a Polygon or MultiPolygon’s ring should be the same.",r))}}(e,t)}}}function I(e,t,n){if(null!==t&&(t=B(e,t)))for(var r,o=i(t.elements);!(r=o()).done;)G(e,r.value,n)}function _(e,t){var n=t.members.find(function(e){return"bbox"===e.name.value});if(void 0!==n){var r=k(e,n.value);r&&(4!==r.elements.length&&6!==r.elements.length&&e.issues.push(j("A bbox must have 4 or 6 positions",r)),L(e,r.elements,"bbox"))}}function J(e,t,n,r){t.name.value===r&&e.issues.push(j(n+" objects cannot contain a member named "+t.name.value,t.name))}var R={Geometry:["properties","geometry","features"],Feature:["features"],FeatureCollection:["properties","coordinates"]};function U(e,t,n){for(var r,o=i(t.members);!(r=o()).done;)for(var u,s=r.value,l=i(R[n]);!(u=l()).done;)J(e,s,n,u.value)}function D(e,t){var n=C(e,t,"coordinates");return n?k(e,n):null}var z=function(e,t){_(e,t),U(e,t,"Geometry")},W=function(e,t){U(e,t,"Feature");var n=C(e,t,"geometry");if(_(e,t),"Null"!==(null==n?void 0:n.type)){var r=T(e,n);r&&H(e,r,M)}var o=t.members.find(function(e){return"id"===e.name.value});o&&"String"!==o.value.type&&"Number"!==o.value.type&&e.issues.push(j("The Feature id must be a string or number.",t));var u=C(e,t,"properties");if(u){var s=u.type;"Object"!==s&&"Null"!==s&&e.issues.push(j("The Feature properties member can be an object or null.",t))}else e.issues.push(j("The properties member is missing.",t))},q={LineString:function(e,t){G(e,D(e,t),"LineString"),z(e,t)},MultiLineString:function(e,t){I(e,D(e,t),"LineString"),z(e,t)},Polygon:function(e,t){I(e,D(e,t),"Polygon"),z(e,t)},MultiPolygon:function(e,t){!function(e,t,n){if(null!==t&&(t=B(e,t)))for(var r,o=i(t.elements);!(r=o()).done;)I(e,r.value,"Polygon")}(e,D(e,t)),z(e,t)},Point:function(e,t){$(e,D(e,t)),z(e,t)},MultiPoint:function(e,t){G(e,D(e,t)),z(e,t)},GeometryCollection:function(e,t){z(e,t);var n=k(e,C(e,t,"geometries"));if(n)for(var r,o=i(n.elements);!(r=o()).done;)H(e,r.value,A)},Feature:W,FeatureCollection:function(e,t){U(e,t,"FeatureCollection");var n=k(e,C(e,t,"features"));if(n)for(var r,o=i(n.elements);!(r=o()).done;){var u=e.issues.length,s=T(e,r.value);s&&(F(e,s,N),W(e,s)),e.valid.push(e.issues.length===u?void 0:e.issues.slice(u))}}};function H(e,t,n){void 0===n&&(n=E);var r=F(e,t,n),o=r.type,u=r.objectNode;o&&u&&(function(e,t){for(var n,r=new Set,o=i(t.members);!(n=o()).done;){var u=n.value,s=u.name.value;r.has(s)&&e.issues.push(j("Duplicate properties are ambiguous in GeoJSON",u)),r.add(s)}}(e,u),q[o](e,u))}function K(e){var t,n={issues:[],valid:[]};try{H(n,(t=function(e,t){const n=function(e,t){t=Object.freeze({...v,...t});let n=-1,r=1,o=0,u=!1;const s=[];function i(e,n,r,o){const u=r.offset+n.length;return{type:e,value:n,loc:{start:r,end:o||{line:r.line,column:r.column+n.length,offset:u}},...t.ranges?{range:[r.offset,u]}:void 0}}function f(){let t=e.charAt(++n);return u?(r++,o=1,u=!1):o++,"\r"===t?(u=!0,"\n"===e.charAt(n+1)&&n++):"\n"===t&&(u=!0),t}function m(){return{line:r,column:o,offset:n}}function O(t){let r=l.get(t);if(e.slice(n,n+r.length)===r)return n+=r.length-1,o+=r.length-1,{value:r,c:f()};for(let t=1;t<r.length;t++)r[t]!==e.charAt(n+t)&&x(f())}function P(e){let t=e;for(e=f();e&&'"'!==e;){if("\\"===e)if(t+=e,e=f(),a.has(e))t+=e;else if("u"===e){t+=e;for(let n=0;n<4;n++)b(e=f())?t+=e:x(e)}else x(e);else t+=e;e=f()}return e||N(),t+=e,{value:t,c:f()}}function S(e){let t="";if("-"===e&&(t+=e,y(e=f())||x(e)),"0"===e)t+=e,y(e=f())&&x(e);else{(function(e){return e>="1"&&e<="9"})(e)||x(e);do{t+=e,e=f()}while(y(e))}if("."===e)do{t+=e,e=f()}while(y(e));if("e"===e||"E"===e)for(t+=e,"+"!==(e=f())&&"-"!==e||(t+=e,e=f()),y(e)||x(e);y(e);)t+=e,e=f();return{value:t,c:e}}function j(e){let t=e;if("/"===(e=f())){do{t+=e,e=f()}while(e&&"\r"!==e&&"\n"!==e);return{value:t,c:e}}if("*"===e){for(;e;)if(t+=e,"*"===(e=f())&&(t+=e,"/"===(e=f())))return t+=e,{value:t,c:e=f()};N()}x(e)}function x(e){throw new p(e,m())}function N(){throw new h(m())}let M=f();for(;n<e.length;){for(;d(M);)M=f();if(!M)break;const e=m();if(c.has(M))s.push(i(c.get(M),M,e)),M=f();else if(g(M)){const t=O(M);let n=t.value;M=t.c,s.push(i(c.get(n),n,e))}else if(w(M)){const t=S(M);M=t.c,s.push(i("Number",t.value,e))}else if('"'===M){const t=P(M);M=t.c,s.push(i("String",t.value,e))}else if("/"===M&&t.comments){const t=j(M);let n=t.value;M=t.c,s.push(i(n.startsWith("//")?"LineComment":"BlockComment",n,e,m()))}else x(M)}return s}(e,{comments:!!(t=Object.freeze({...O,...t})).comments,ranges:!!t.ranges});let r=0;const o=t.comments?function e(){const t=n[r++];return t&&t.type.endsWith("Comment")?e():t}:function(){return n[r++]};function u(e,t){if(!e||e.value!==t)throw new m(e)}function s(e,n){return t.ranges?{range:[e.offset,n.offset]}:void 0}function i(e){const t=s(e.loc.start,e.loc.end);return{type:e.type,value:P(e),loc:{start:{...e.loc.start},end:{...e.loc.end}},...t}}function f(e){!function(e,t){if(!e||"String"!==e.type)throw new m(e)}(e);const t=i(e);u(e=o(),":");const n=S(),r=s(t.loc.start,n.loc.end);return((e,t,n={})=>({type:"Member",name:e,value:t,...n}))(t,n,{loc:{start:{...t.loc.start},end:{...n.loc.end}},...r})}function S(e){switch((e=e||o()).type){case"String":case"Boolean":case"Number":case"Null":return i(e);case"Punctuator":if("{"===e.value)return function(e){u(e,"{");const t=[];let n=o();if(n&&"}"!==n.value)do{if(t.push(f(n)),n=o(),","!==n.value)break;n=o()}while(n);u(n,"}");const r=s(e.loc.start,n.loc.end);return((e,t={})=>({type:"Object",members:e,...t}))(t,{loc:{start:{...e.loc.start},end:{...n.loc.end}},...r})}(e);if("["===e.value)return function(e){u(e,"[");const t=[];let n=o();if(n&&"]"!==n.value)do{if(t.push(S(n)),n=o(),","!==n.value)break;n=o()}while(n);u(n,"]");const r=s(e.loc.start,n.loc.end);return((e,t={})=>({type:"Array",elements:e,...t}))(t,{type:"Array",elements:t,loc:{start:{...e.loc.start},end:{...n.loc.end}},...r})}(e);default:throw new m(e)}}const j=S(),x=o();if(x)throw new m(x);const N={loc:{start:{line:1,column:1,offset:0},end:{...j.loc.end}}};return t.tokens&&(N.tokens=n),t.ranges&&(N.range=s(N.loc.start,N.loc.end)),((e,t={})=>({type:"Document",body:e,...t}))(j,N)}(e,{ranges:!0})).body)}catch(e){n.issues.push({message:"Invalid JSON: "+e.message,from:0,to:0,severity:"error"})}return{ast:t,ctx:n}}exports.HintError=x,exports.check=function(e){var t=K(e),n=t.ctx,r=t.ast;if(n.issues.length||!r)throw new x(n.issues);return S(r)},exports.getIssues=function(e){return K(e).ctx.issues},exports.scavenge=function(t){var n=K(t),r=n.ctx,o=r.issues,u=r.valid,s=n.ast;if(!s)throw new x(o);var i=S(s);if(!o.length)return{result:i,rejected:[]};if("FeatureCollection"===i.type)return{result:e({},i,{features:i.features.filter(function(e,t){return void 0===u[t]})}),rejected:i.features.flatMap(function(e,t){var n=u[t];return n?[{feature:e,reasons:n}]:[]})};throw new x(o)};
//# sourceMappingURL=index.js.map
