!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self).checkGeojson={})}(this,function(e){function t(){return t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}function n(e){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function u(e,t,n){return u=o()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var u=new(Function.bind.apply(e,o));return n&&r(u,n.prototype),u},u.apply(null,arguments)}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return u(e,arguments,n(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),r(o,e)},s(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}const a="true",c="false",f="null",p=new Map([["t",a],["f",c],["n",f]]),m=new Map([['"','"'],["\\","\\"],["/","/"],["b","\b"],["n","\n"],["f","\f"],["r","\r"],["t","\t"]]),h=new Map([["[","Punctuator"],["]","Punctuator"],["{","Punctuator"],["}","Punctuator"],[":","Punctuator"],[",","Punctuator"],[a,"Boolean"],[c,"Boolean"],[f,"Null"]]);class d extends Error{constructor(e,{line:t,column:n,index:r}){super(`${e} (${t}:${n})`),this.line=t,this.column=n,this.index=r}}class v extends d{constructor(e,t){super(`Unexpected character ${e} found.`,t)}}class y extends d{constructor(e){super(`Unexpected token ${e.type}(${e.value}) found.`,e.loc.start)}}class b extends d{constructor(e){super("Unexpected end of input found.",e)}}const g={comments:!1,ranges:!1};function w(e){return/[\s\n]/.test(e)}function j(e){return e>="0"&&e<="9"}function O(e){return j(e)||/[a-f]/i.test(e)}function P(e){return/[tfn]/.test(e)}function S(e){return j(e)||"."===e||"-"===e}const x={tokens:!1,comments:!1,ranges:!1};function N(e){switch(e.type){case"Boolean":return"true"===e.value;case"Number":return Number(e.value);case"Null":return null;case"String":return function(e){let t=e.value.slice(1,-1),n="",r=t.indexOf("\\"),o=0;for(;r>=0;){n+=t.slice(o,r);const u=t.charAt(r+1);if(m.has(u))n+=m.get(u),o=r+2;else{if("u"!==u)throw new d(`Invalid escape \\${u}.`,{line:e.loc.start.line,column:e.loc.start.column+r,offset:e.loc.start.offset+r});{const u=t.slice(r+2,r+6);if(u.length<4||/[^0-9a-f]/i.test(u))throw new d(`Invalid unicode escape \\u${u}.`,{line:e.loc.start.line,column:e.loc.start.column+r,offset:e.loc.start.offset+r});n+=String.fromCharCode(parseInt(u,16)),o=r+6}}r=t.indexOf("\\",o)}return n+=t.slice(o),n}(e)}}var M=function e(t){switch(t.type){case"String":case"Number":case"Boolean":return t.value;case"Null":return null;case"Array":return t.elements.map(e);case"Object":{const n={};return t.members.forEach(t=>{n[e(t.name)]=e(t.value)}),n}case"Document":return e(t.body);case"Property":throw new Error("Cannot evaluate object property outside of an object.");default:throw new Error(`Unknown node type ${t.type}.`)}};function A(e,t){return{message:e,severity:"error",from:t.loc.start.offset,to:t.loc.end.offset}}var E=/*#__PURE__*/function(e){var t,n,o,u;function s(t){var n;(n=e.call(this)||this).issues=[];var r=(this instanceof s?this.constructor:void 0).prototype;return Object.setPrototypeOf(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),r),n.issues=t,n}return n=e,(t=s).prototype=Object.create(n.prototype),t.prototype.constructor=t,r(t,n),o=s,(u=[{key:"message",get:function(){return JSON.stringify(this.issues,null,2)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(o.prototype,u),Object.defineProperty(o,"prototype",{writable:!1}),s}(/*#__PURE__*/s(Error)),F=new Set(["Feature"]),k=new Set(["Point","MultiPoint","Polygon","MultiPolygon","LineString","MultiLineString","GeometryCollection"]),C=new Set(["Point","MultiPoint","Polygon","MultiPolygon","LineString","MultiLineString"]),T=new Set(Array.from(k).concat(["Feature","FeatureCollection"]));function L(e,t,n){if("Object"!==t.type)throw new E([A("Expected an object, but found an incorrect type.",t)]);var r=t.members.find(function(e){return"type"===e.name.value});if(!r)return e.issues.push(A("This GeoJSON object is missing its type member.",t)),{};var o=r.value;return"String"!==o.type?(e.issues.push(A("The type member should have been a string.",t)),{}):n.has(o.value)?{type:o.value,objectNode:t}:(e.issues.push(A("This type of GeoJSON object is not allowed here.",t)),{})}function $(e,t,n){var r=t.members.find(function(e){return e.name.value===n});return r?r.value:(e.issues.push(A("This GeoJSON object requires a "+n+" member but it is missing.",t)),null)}function G(e,t){return"Array"===(null==t?void 0:t.type)?t:(t&&e.issues.push(A("This must be an array.",t)),null)}function B(e,t){return"Object"===(null==t?void 0:t.type)?t:(t&&e.issues.push(A("This must be an object.",t)),null)}function I(e,t,n){for(var r,o=l(t);!(r=o()).done;){var u=r.value;if("Number"!==u.type)return void e.issues.push(A("Each element in a "+n+" must be a number.",u))}}function _(e,t){null!==t&&((t.elements.length<2||t.elements.length>3)&&e.issues.push(A("A position should have 2 or 3 elements - found "+t.elements.length+".",t)),I(e,t.elements,"position"))}function J(e,t){return"Array"!==t.type?(e.issues.push(A("Expected to find an array of positions here.",t)),null):t}function R(e,t,n){if(null!==t&&(t=J(e,t))){for(var r,o=l(t.elements);!(r=o()).done;){var u=r.value;if("Array"!==u.type)return void e.issues.push(A("Expected to find a position here, found another type.",u));_(e,u)}switch(n){case"LineString":t.elements.length<2&&e.issues.push(A("Expected to find two or more positions here.",t));break;case"Polygon":t.elements.length<4&&e.issues.push(A("Expected to find four or more positions here.",t)),function(e,t){for(var n=t.elements[0],r=t.elements[t.elements.length-1],o=Math.max(n.elements.length,r.elements.length),u=0;u<o;u++){var s,i;if((null==(s=n.elements[u])?void 0:s.value)!==(null==(i=r.elements[u])?void 0:i.value))return void e.issues.push(A("First and last positions of a Polygon or MultiPolygon’s ring should be the same.",n),A("First and last positions of a Polygon or MultiPolygon’s ring should be the same.",r))}}(e,t)}}}function U(e,t,n){if(null!==t&&(t=J(e,t)))for(var r,o=l(t.elements);!(r=o()).done;)R(e,r.value,n)}function D(e,t){var n=t.members.find(function(e){return"bbox"===e.name.value});if(void 0!==n){var r=G(e,n.value);r&&(4!==r.elements.length&&6!==r.elements.length&&e.issues.push(A("A bbox must have 4 or 6 positions",r)),I(e,r.elements,"bbox"))}}function z(e,t,n,r){t.name.value===r&&e.issues.push(A(n+" objects cannot contain a member named "+t.name.value,t.name))}var W={Geometry:["properties","geometry","features"],Feature:["features"],FeatureCollection:["properties","coordinates"]};function q(e,t,n){for(var r,o=l(t.members);!(r=o()).done;)for(var u,s=r.value,i=l(W[n]);!(u=i()).done;)z(e,s,n,u.value)}function H(e,t){var n=$(e,t,"coordinates");return n?G(e,n):null}var K=function(e,t){D(e,t),q(e,t,"Geometry")},Q=function(e,t){q(e,t,"Feature");var n=$(e,t,"geometry");if(D(e,t),"Null"!==(null==n?void 0:n.type)){var r=B(e,n);r&&X(e,r,k)}var o=t.members.find(function(e){return"id"===e.name.value});o&&"String"!==o.value.type&&"Number"!==o.value.type&&e.issues.push(A("The Feature id must be a string or number.",t));var u=$(e,t,"properties");if(u){var s=u.type;"Object"!==s&&"Null"!==s&&e.issues.push(A("The Feature properties member can be an object or null.",t))}else e.issues.push(A("The properties member is missing.",t))},V={LineString:function(e,t){R(e,H(e,t),"LineString"),K(e,t)},MultiLineString:function(e,t){U(e,H(e,t),"LineString"),K(e,t)},Polygon:function(e,t){U(e,H(e,t),"Polygon"),K(e,t)},MultiPolygon:function(e,t){!function(e,t,n){if(null!==t&&(t=J(e,t)))for(var r,o=l(t.elements);!(r=o()).done;)U(e,r.value,"Polygon")}(e,H(e,t)),K(e,t)},Point:function(e,t){_(e,H(e,t)),K(e,t)},MultiPoint:function(e,t){R(e,H(e,t)),K(e,t)},GeometryCollection:function(e,t){K(e,t);var n=G(e,$(e,t,"geometries"));if(n)for(var r,o=l(n.elements);!(r=o()).done;)X(e,r.value,C)},Feature:Q,FeatureCollection:function(e,t){q(e,t,"FeatureCollection");var n=G(e,$(e,t,"features"));if(n)for(var r,o=l(n.elements);!(r=o()).done;){var u=e.issues.length,s=B(e,r.value);s&&(L(e,s,F),Q(e,s)),e.valid.push(e.issues.length===u?void 0:e.issues.slice(u))}}};function X(e,t,n){void 0===n&&(n=T);var r=L(e,t,n),o=r.type,u=r.objectNode;o&&u&&(function(e,t){for(var n,r=new Set,o=l(t.members);!(n=o()).done;){var u=n.value,s=u.name.value;r.has(s)&&e.issues.push(A("Duplicate properties are ambiguous in GeoJSON",u)),r.add(s)}}(e,u),V[o](e,u))}function Y(e){var t,n={issues:[],valid:[]};try{X(n,(t=function(e,t){const n=function(e,t){t=Object.freeze({...g,...t});let n=-1,r=1,o=0,u=!1;const s=[];function i(e,n,r,o){const u=r.offset+n.length;return{type:e,value:n,loc:{start:r,end:o||{line:r.line,column:r.column+n.length,offset:u}},...t.ranges?{range:[r.offset,u]}:void 0}}function l(){let t=e.charAt(++n);return u?(r++,o=1,u=!1):o++,"\r"===t?(u=!0,"\n"===e.charAt(n+1)&&n++):"\n"===t&&(u=!0),t}function a(){return{line:r,column:o,offset:n}}function c(t){let r=p.get(t);if(e.slice(n,n+r.length)===r)return n+=r.length-1,o+=r.length-1,{value:r,c:l()};for(let t=1;t<r.length;t++)r[t]!==e.charAt(n+t)&&x(l())}function f(e){let t=e;for(e=l();e&&'"'!==e;){if("\\"===e)if(t+=e,e=l(),m.has(e))t+=e;else if("u"===e){t+=e;for(let n=0;n<4;n++)O(e=l())?t+=e:x(e)}else x(e);else t+=e;e=l()}return e||N(),t+=e,{value:t,c:l()}}function d(e){let t="";if("-"===e&&(t+=e,j(e=l())||x(e)),"0"===e)t+=e,j(e=l())&&x(e);else{(function(e){return e>="1"&&e<="9"})(e)||x(e);do{t+=e,e=l()}while(j(e))}if("."===e)do{t+=e,e=l()}while(j(e));if("e"===e||"E"===e)for(t+=e,"+"!==(e=l())&&"-"!==e||(t+=e,e=l()),j(e)||x(e);j(e);)t+=e,e=l();return{value:t,c:e}}function y(e){let t=e;if("/"===(e=l())){do{t+=e,e=l()}while(e&&"\r"!==e&&"\n"!==e);return{value:t,c:e}}if("*"===e){for(;e;)if(t+=e,"*"===(e=l())&&(t+=e,"/"===(e=l())))return t+=e,{value:t,c:e=l()};N()}x(e)}function x(e){throw new v(e,a())}function N(){throw new b(a())}let M=l();for(;n<e.length;){for(;w(M);)M=l();if(!M)break;const e=a();if(h.has(M))s.push(i(h.get(M),M,e)),M=l();else if(P(M)){const t=c(M);let n=t.value;M=t.c,s.push(i(h.get(n),n,e))}else if(S(M)){const t=d(M);M=t.c,s.push(i("Number",t.value,e))}else if('"'===M){const t=f(M);M=t.c,s.push(i("String",t.value,e))}else if("/"===M&&t.comments){const t=y(M);let n=t.value;M=t.c,s.push(i(n.startsWith("//")?"LineComment":"BlockComment",n,e,a()))}else x(M)}return s}(e,{comments:!!(t=Object.freeze({...x,...t})).comments,ranges:!!t.ranges});let r=0;const o=t.comments?function e(){const t=n[r++];return t&&t.type.endsWith("Comment")?e():t}:function(){return n[r++]};function u(e,t){if(!e||e.value!==t)throw new y(e)}function s(e,n){return t.ranges?{range:[e.offset,n.offset]}:void 0}function i(e){const t=s(e.loc.start,e.loc.end);return{type:e.type,value:N(e),loc:{start:{...e.loc.start},end:{...e.loc.end}},...t}}function l(e){!function(e,t){if(!e||"String"!==e.type)throw new y(e)}(e);const t=i(e);u(e=o(),":");const n=a(),r=s(t.loc.start,n.loc.end);return((e,t,n={})=>({type:"Member",name:e,value:t,...n}))(t,n,{loc:{start:{...t.loc.start},end:{...n.loc.end}},...r})}function a(e){switch((e=e||o()).type){case"String":case"Boolean":case"Number":case"Null":return i(e);case"Punctuator":if("{"===e.value)return function(e){u(e,"{");const t=[];let n=o();if(n&&"}"!==n.value)do{if(t.push(l(n)),n=o(),","!==n.value)break;n=o()}while(n);u(n,"}");const r=s(e.loc.start,n.loc.end);return((e,t={})=>({type:"Object",members:e,...t}))(t,{loc:{start:{...e.loc.start},end:{...n.loc.end}},...r})}(e);if("["===e.value)return function(e){u(e,"[");const t=[];let n=o();if(n&&"]"!==n.value)do{if(t.push(a(n)),n=o(),","!==n.value)break;n=o()}while(n);u(n,"]");const r=s(e.loc.start,n.loc.end);return((e,t={})=>({type:"Array",elements:e,...t}))(t,{type:"Array",elements:t,loc:{start:{...e.loc.start},end:{...n.loc.end}},...r})}(e);default:throw new y(e)}}const c=a(),f=o();if(f)throw new y(f);const d={loc:{start:{line:1,column:1,offset:0},end:{...c.loc.end}}};return t.tokens&&(d.tokens=n),t.ranges&&(d.range=s(d.loc.start,d.loc.end)),((e,t={})=>({type:"Document",body:e,...t}))(c,d)}(e,{ranges:!0})).body)}catch(e){n.issues.push({message:"Invalid JSON: "+e.message,from:0,to:0,severity:"error"})}return{ast:t,ctx:n}}e.HintError=E,e.check=function(e){var t=Y(e),n=t.ctx,r=t.ast;if(n.issues.length||!r)throw new E(n.issues);return M(r)},e.getIssues=function(e){return Y(e).ctx.issues},e.scavenge=function(e){var n=Y(e),r=n.ctx,o=r.issues,u=r.valid,s=n.ast;if(!s)throw new E(o);var i=M(s);if(!o.length)return{result:i,rejected:[]};if("FeatureCollection"===i.type)return{result:t({},i,{features:i.features.filter(function(e,t){return void 0===u[t]})}),rejected:i.features.flatMap(function(e,t){var n=u[t];return n?[{feature:e,reasons:n}]:[]})};throw new E(o)}});
//# sourceMappingURL=index.umd.js.map
